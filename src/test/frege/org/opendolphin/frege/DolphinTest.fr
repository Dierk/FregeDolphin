module org.opendolphin.frege.DolphinTest where

import org.opendolphin.frege.Dolphin

import Test.QuickCheck

dummy = once true

initialQualifier  = "initial qualifier"
noSuchQualifier   = "no such qualifier"
modifiedQualifier = "modified qualifier"

startDolphin = Dolphin empty empty empty empty

-- create one PM with one Attribute and fixed value and qualifier at the provided key
onePmAttrDolphin ∷ Int → Dolphin 
onePmAttrDolphin key = with startDolphin do 
    zero = Just $ IntVal 0 0
    qual = Just initialQualifier
    attr = Attr "PM_KEY" "myPropName" Value zero qual
    addAttribute (toLongIndex key) attr
    
    
foundByQualifier    = property $ \key -> 
    findAttrIdsByQualifier (onePmAttrDolphin key) initialQualifier    == [toLongIndex key]

notFoundByQualifier = property $ \key -> 
    findAttrIdsByQualifier (onePmAttrDolphin key) noSuchQualifier == []

dolphinWithUpdatedQualifier key = with (onePmAttrDolphin key) do
    modifyQualifier (toLongIndex key) (Just modifiedQualifier)

foundByModifiedQualifier = property $ \key -> 
    findAttrIdsByQualifier (dolphinWithUpdatedQualifier key) modifiedQualifier == [toLongIndex key]
    
noMoreOldQualifierAfterModification = property $ \key ->     
    findAttrIdsByQualifier (dolphinWithUpdatedQualifier key) initialQualifier == []
    
    
originalValue = property $ \key -> 
    ((onePmAttrDolphin key).attrById.lookup (toLongIndex key) >>= _.value) == Just (IntVal 0 0)

dolphinWithUpdatedValue key value = with (onePmAttrDolphin key) do
	modifyValue (toLongIndex key) (Just (IntVal 0 value))

modifiedValue = property $ \key \value -> 
    ((dolphinWithUpdatedValue key value).attrById.lookup (toLongIndex key) >>= _.value) == Just (IntVal 0 value)

                